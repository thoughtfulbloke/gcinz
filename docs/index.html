<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A New Zealand view of the Good Country Index</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="A NZer on GCI">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="A New Zealand view of the Good Country Index" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A NZer on GCI" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A New Zealand view of the Good Country Index" />
  
  <meta name="twitter:description" content="A NZer on GCI" />
  

<meta name="author" content="David Hood">


<meta name="date" content="2017-10-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  

<link rel="next" href="overall-total-score.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">NZ analysis of GCI</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overall-total-score.html"><a href="overall-total-score.html"><i class="fa fa-check"></i><b>2</b> Overall - Total Score</a></li>
<li class="chapter" data-level="3" data-path="science-technology-aggregate-score.html"><a href="science-technology-aggregate-score.html"><i class="fa fa-check"></i><b>3</b> Science &amp; Technology - Aggregate Score</a><ul>
<li class="chapter" data-level="3.1" data-path="international-students-science-technology.html"><a href="international-students-science-technology.html"><i class="fa fa-check"></i><b>3.1</b> International Students Science &amp; Technology</a></li>
<li class="chapter" data-level="3.2" data-path="journal-exports-science-technology.html"><a href="journal-exports-science-technology.html"><i class="fa fa-check"></i><b>3.2</b> Journal exports Science &amp; Technology</a></li>
<li class="chapter" data-level="3.3" data-path="international-publications-science-technology.html"><a href="international-publications-science-technology.html"><i class="fa fa-check"></i><b>3.3</b> International publications Science &amp; Technology</a></li>
<li class="chapter" data-level="3.4" data-path="nobel-prizes-science-technology.html"><a href="nobel-prizes-science-technology.html"><i class="fa fa-check"></i><b>3.4</b> Nobel prizes Science &amp; Technology</a></li>
<li class="chapter" data-level="3.5" data-path="patents-science-technology.html"><a href="patents-science-technology.html"><i class="fa fa-check"></i><b>3.5</b> Patents Science &amp; Technology</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="culture-aggregate-score.html"><a href="culture-aggregate-score.html"><i class="fa fa-check"></i><b>4</b> Culture - Aggregate Score</a><ul>
<li class="chapter" data-level="4.1" data-path="creative-goods-exports-culture.html"><a href="creative-goods-exports-culture.html"><i class="fa fa-check"></i><b>4.1</b> Creative goods exports Culture</a></li>
<li class="chapter" data-level="4.2" data-path="creative-services-exports-culture.html"><a href="creative-services-exports-culture.html"><i class="fa fa-check"></i><b>4.2</b> Creative services exports Culture</a></li>
<li class="chapter" data-level="4.3" data-path="unesco-dues-in-arrears-as-of-contribution-culture.html"><a href="unesco-dues-in-arrears-as-of-contribution-culture.html"><i class="fa fa-check"></i><b>4.3</b> UNESCO dues in arrears as % of contribution Culture</a></li>
<li class="chapter" data-level="4.4" data-path="freedom-of-movement-culture.html"><a href="freedom-of-movement-culture.html"><i class="fa fa-check"></i><b>4.4</b> Freedom of movement Culture</a></li>
<li class="chapter" data-level="4.5" data-path="press-freedom-culture.html"><a href="press-freedom-culture.html"><i class="fa fa-check"></i><b>4.5</b> Press freedom Culture</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="international-peace-security-aggregate-score.html"><a href="international-peace-security-aggregate-score.html"><i class="fa fa-check"></i><b>5</b> International Peace &amp; Security - Aggregate Score</a><ul>
<li class="chapter" data-level="5.1" data-path="peacekeeping-troops-international-peace-security.html"><a href="peacekeeping-troops-international-peace-security.html"><i class="fa fa-check"></i><b>5.1</b> Peacekeeping troops International Peace &amp; Security</a></li>
<li class="chapter" data-level="5.2" data-path="dues-in-arrears-to-un-peace-keeping-budgets-international-peace-security.html"><a href="dues-in-arrears-to-un-peace-keeping-budgets-international-peace-security.html"><i class="fa fa-check"></i><b>5.2</b> Dues in arrears to UN peace keeping budgets International Peace &amp; Security</a></li>
<li class="chapter" data-level="5.3" data-path="international-violent-conflict-international-peace-security.html"><a href="international-violent-conflict-international-peace-security.html"><i class="fa fa-check"></i><b>5.3</b> International violent conflict International Peace &amp; Security</a></li>
<li class="chapter" data-level="5.4" data-path="arms-exports-international-peace-security.html"><a href="arms-exports-international-peace-security.html"><i class="fa fa-check"></i><b>5.4</b> Arms exports International Peace &amp; Security</a></li>
<li class="chapter" data-level="5.5" data-path="internet-security-2014-international-peace-security.html"><a href="internet-security-2014-international-peace-security.html"><i class="fa fa-check"></i><b>5.5</b> Internet security (2014) International Peace &amp; Security</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="world-order-aggregate-score.html"><a href="world-order-aggregate-score.html"><i class="fa fa-check"></i><b>6</b> World Order - Aggregate Score</a><ul>
<li class="chapter" data-level="6.1" data-path="charity-giving-world-order.html"><a href="charity-giving-world-order.html"><i class="fa fa-check"></i><b>6.1</b> Charity giving World Order</a></li>
<li class="chapter" data-level="6.2" data-path="refugees-hosted-world-order.html"><a href="refugees-hosted-world-order.html"><i class="fa fa-check"></i><b>6.2</b> Refugees hosted World Order</a></li>
<li class="chapter" data-level="6.3" data-path="refugees-generated-world-order.html"><a href="refugees-generated-world-order.html"><i class="fa fa-check"></i><b>6.3</b> Refugees generated World Order</a></li>
<li class="chapter" data-level="6.4" data-path="birth-rate-world-order.html"><a href="birth-rate-world-order.html"><i class="fa fa-check"></i><b>6.4</b> Birth rate World Order</a></li>
<li class="chapter" data-level="6.5" data-path="un-treaties-signed-world-order.html"><a href="un-treaties-signed-world-order.html"><i class="fa fa-check"></i><b>6.5</b> UN Treaties signed World Order</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="planet-climate-aggregate-score.html"><a href="planet-climate-aggregate-score.html"><i class="fa fa-check"></i><b>7</b> Planet &amp; Climate - Aggregate Score</a><ul>
<li class="chapter" data-level="7.1" data-path="ecological-footprint-planet-climate.html"><a href="ecological-footprint-planet-climate.html"><i class="fa fa-check"></i><b>7.1</b> Ecological footprint Planet &amp; Climate</a></li>
<li class="chapter" data-level="7.2" data-path="reforestation-since-1992-planet-climate.html"><a href="reforestation-since-1992-planet-climate.html"><i class="fa fa-check"></i><b>7.2</b> Reforestation since 1992 Planet &amp; Climate</a></li>
<li class="chapter" data-level="7.3" data-path="hazardous-pesticides-exports-planet-climate.html"><a href="hazardous-pesticides-exports-planet-climate.html"><i class="fa fa-check"></i><b>7.3</b> Hazardous pesticides exports Planet &amp; Climate</a></li>
<li class="chapter" data-level="7.4" data-path="co2-emissions-planet-climate.html"><a href="co2-emissions-planet-climate.html"><i class="fa fa-check"></i><b>7.4</b> CO2 emissions Planet &amp; Climate</a></li>
<li class="chapter" data-level="7.5" data-path="ozone-planet-climate.html"><a href="ozone-planet-climate.html"><i class="fa fa-check"></i><b>7.5</b> Ozone Planet &amp; Climate</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="prosperity-equality-aggregate-score.html"><a href="prosperity-equality-aggregate-score.html"><i class="fa fa-check"></i><b>8</b> Prosperity &amp; Equality - Aggregate Score</a><ul>
<li class="chapter" data-level="8.1" data-path="open-trading-prosperity-equality.html"><a href="open-trading-prosperity-equality.html"><i class="fa fa-check"></i><b>8.1</b> Open trading Prosperity &amp; Equality</a></li>
<li class="chapter" data-level="8.2" data-path="un-volunteers-abroad-prosperity-equality.html"><a href="un-volunteers-abroad-prosperity-equality.html"><i class="fa fa-check"></i><b>8.2</b> UN volunteers abroad Prosperity &amp; Equality</a></li>
<li class="chapter" data-level="8.3" data-path="fairtrade-market-size-prosperity-equality.html"><a href="fairtrade-market-size-prosperity-equality.html"><i class="fa fa-check"></i><b>8.3</b> Fairtrade market size Prosperity &amp; Equality</a></li>
<li class="chapter" data-level="8.4" data-path="fdi-outflows-prosperity-equality.html"><a href="fdi-outflows-prosperity-equality.html"><i class="fa fa-check"></i><b>8.4</b> FDI outflows Prosperity &amp; Equality</a></li>
<li class="chapter" data-level="8.5" data-path="development-assistance-prosperity-equality.html"><a href="development-assistance-prosperity-equality.html"><i class="fa fa-check"></i><b>8.5</b> Development assistance Prosperity &amp; Equality</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="health-wellbeing-aggregate-score.html"><a href="health-wellbeing-aggregate-score.html"><i class="fa fa-check"></i><b>9</b> Health &amp; Wellbeing - Aggregate Score</a><ul>
<li class="chapter" data-level="9.1" data-path="food-aid-health-wellbeing.html"><a href="food-aid-health-wellbeing.html"><i class="fa fa-check"></i><b>9.1</b> Food aid Health &amp; Wellbeing</a></li>
<li class="chapter" data-level="9.2" data-path="pharmaceutical-exports-health-wellbeing.html"><a href="pharmaceutical-exports-health-wellbeing.html"><i class="fa fa-check"></i><b>9.2</b> Pharmaceutical exports Health &amp; Wellbeing</a></li>
<li class="chapter" data-level="9.3" data-path="voluntary-excess-donations-to-the-who-health-wellbeing.html"><a href="voluntary-excess-donations-to-the-who-health-wellbeing.html"><i class="fa fa-check"></i><b>9.3</b> Voluntary excess donations to the WHO Health &amp; Wellbeing</a></li>
<li class="chapter" data-level="9.4" data-path="humanitarian-aid-donations-health-wellbeing.html"><a href="humanitarian-aid-donations-health-wellbeing.html"><i class="fa fa-check"></i><b>9.4</b> Humanitarian aid donations Health &amp; Wellbeing</a></li>
<li class="chapter" data-level="9.5" data-path="international-health-regulations-compliance-health-wellbeing.html"><a href="international-health-regulations-compliance-health-wellbeing.html"><i class="fa fa-check"></i><b>9.5</b> International Health Regulations Compliance Health &amp; Wellbeing</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="r-information-and-citations.html"><a href="r-information-and-citations.html"><i class="fa fa-check"></i><b>10</b> R information and citations</a></li>
<li class="divider"></li>
<li><a href="https://thoughtfulbloke.github.io/gcinz/gcinz.pdf">pdf version</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A New Zealand view of the Good Country Index</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">A New Zealand view of the Good Country Index</h1>
<h4 class="author"><em>David Hood</em></h4>
<h4 class="date"><em>2017-10-30</em></h4>
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Introduction</h1>
<p>In response to a tweet from <a href="https://twitter.com/HelenClarkNZ/status/919274220890284033">helenclarknz</a> I thought I would take a closer look, from a New Zealand perspective, at the Good Country Index:</p>
<p><a href="https://goodcountry.org/index/results" class="uri">https://goodcountry.org/index/results</a></p>
<p>Which has a description of the original data here</p>
<p><a href="https://goodcountry.org/index/source-data" class="uri">https://goodcountry.org/index/source-data</a></p>
<p>As the Good Country Index is licenced as Creative Commmons Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) the products of this analysis should be considered similar. The code for generating my analysis I am releasing under an MIT licence, so you are welcome to use and adapt it with attribution. The data forming the index was downloaded from the site on the 23rd of October 2017</p>
<p>I am also drawing on World Bank GDP per capita data</p>
<p><a href="https://data.worldbank.org/indicator/NY.GDP.PCAP.CD" class="uri">https://data.worldbank.org/indicator/NY.GDP.PCAP.CD</a></p>
<p>and World Bank GDP (current US$)</p>
<p><a href="https://data.worldbank.org/indicator/NY.GDP.MKTP.CD" class="uri">https://data.worldbank.org/indicator/NY.GDP.MKTP.CD</a></p>
<p>which is open licenced, via the direct csv download link from the above pages</p>
<p>Wikipedia’s list of oldest Universities by County</p>
<p><a href="https://en.wikipedia.org/wiki/List_of_oldest_universities_in_continuous_operation" class="uri">https://en.wikipedia.org/wiki/List_of_oldest_universities_in_continuous_operation</a></p>
<p>which is licenced with Creative Commons Attribution-ShareAlike 3.0</p>
<p>Finally, I am drawing directly on one of the sources the Good Country Index is based on, The World Bank: Distance to Frontier Score: Doing Business Indicators,</p>
<p><a href="http://www.doingbusiness.org/data/distance-to-frontier" class="uri">http://www.doingbusiness.org/data/distance-to-frontier</a></p>
<p>via the downloadable excel file of data</p>
<p><a href="http://www.doingbusiness.org/data/~/media/WBG/DoingBusiness/Documents/Miscellaneous/DB17-Distance-to-Frontier-historical-dataset.xlsx" class="uri">http://www.doingbusiness.org/data/~/media/WBG/DoingBusiness/Documents/Miscellaneous/DB17-Distance-to-Frontier-historical-dataset.xlsx</a></p>
<p>(note: directly downloading the file gives a different format than clicking the button on the webpage, for this I have used the former)</p>
<p><strong>Data gathering code</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
<span class="kw">library</span>(jsonlite)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(countrycode)
<span class="kw">library</span>(rvest)
<span class="kw">library</span>(feather)

GCI_country_info &lt;-<span class="st"> </span><span class="cf">function</span>(x, gciver){
  gooddf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> x<span class="op">$</span>countries<span class="op">$</span>id,
                     <span class="dt">name =</span> x<span class="op">$</span>countries<span class="op">$</span>name,
                     <span class="dt">isoCode =</span> x<span class="op">$</span>countries<span class="op">$</span>isoCode,
                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
  gooddf<span class="op">$</span>version &lt;-<span class="st"> </span>gciver
  <span class="kw">return</span>(gooddf)
}

v1.1_json &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;https://goodcountry.org/indexData.json?version=1.1&quot;</span>)
v1.0_json &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;https://goodcountry.org/indexData.json?version=1.0&quot;</span>)
gci1.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">GCI_country_info</span>(v1.1_json, <span class="fl">1.1</span>)
gci1.<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">GCI_country_info</span>(v1.0_json, <span class="fl">1.0</span>)

indicate_desc &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, inlist){
  section &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;4&quot;</span>,<span class="st">&quot;12&quot;</span>,<span class="st">&quot;13&quot;</span>,<span class="st">&quot;14&quot;</span>,<span class="st">&quot;15&quot;</span>,<span class="st">&quot;16&quot;</span>,<span class="st">&quot;17&quot;</span>)
  group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Science &amp; Technology&quot;</span>, <span class="st">&quot;Culture&quot;</span>, <span class="st">&quot;International Peace &amp; Security&quot;</span>,
             <span class="st">&quot;World Order&quot;</span>, <span class="st">&quot;Planet &amp; Climate&quot;</span>, <span class="st">&quot;Prosperity &amp; Equality&quot;</span>, <span class="st">&quot;Health &amp; Wellbeing&quot;</span>)
  chap &lt;-<span class="st"> </span>group[section <span class="op">==</span><span class="st"> </span>x]
    title =<span class="st"> </span>inlist[[<span class="st">&quot;indicators&quot;</span>]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;title&quot;</span>]]
    title &lt;-<span class="st"> </span>title[<span class="op">!</span><span class="kw">is.na</span>(title)]
    code =<span class="st"> </span>inlist[[<span class="st">&quot;indicators&quot;</span>]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;code&quot;</span>]]
    code &lt;-<span class="st"> </span>code[<span class="op">!</span><span class="kw">is.na</span>(code)]
    description =<span class="st"> </span>inlist[[<span class="st">&quot;indicators&quot;</span>]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;description&quot;</span>]]
    description &lt;-<span class="st"> </span>description[<span class="op">!</span><span class="kw">is.na</span>(description)]
    reference =<span class="st"> </span>inlist[[<span class="st">&quot;indicators&quot;</span>]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;reference&quot;</span>]]
    reference &lt;-<span class="st"> </span>reference[<span class="op">!</span><span class="kw">is.na</span>(reference)]
    treatment =<span class="st"> </span>inlist[[<span class="st">&quot;indicators&quot;</span>]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;treatment&quot;</span>]]
    treatment &lt;-<span class="st"> </span>treatment[<span class="op">!</span><span class="kw">is.na</span>(treatment)]
 z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">section=</span>chap, title, code, description, reference,
                 treatment, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
  <span class="kw">return</span>(z)
}

arrangement =<span class="st"> &quot;</span>
<span class="st">group,indicator</span>
<span class="st">4,5</span>
<span class="st">4,6</span>
<span class="st">4,7</span>
<span class="st">4,8</span>
<span class="st">4,9</span>
<span class="st">12,10</span>
<span class="st">12,11</span>
<span class="st">12,18</span>
<span class="st">12,19</span>
<span class="st">12,20</span>
<span class="st">13,21</span>
<span class="st">13,22</span>
<span class="st">13,23</span>
<span class="st">13,24</span>
<span class="st">13,25</span>
<span class="st">14,26</span>
<span class="st">14,27</span>
<span class="st">14,28</span>
<span class="st">14,29</span>
<span class="st">14,30</span>
<span class="st">15,31</span>
<span class="st">15,32</span>
<span class="st">15,33</span>
<span class="st">15,34</span>
<span class="st">15,35</span>
<span class="st">16,36</span>
<span class="st">16,37</span>
<span class="st">16,38</span>
<span class="st">16,39</span>
<span class="st">16,40</span>
<span class="st">17,41</span>
<span class="st">17,42</span>
<span class="st">17,43</span>
<span class="st">17,44</span>
<span class="st">17,45&quot;</span>

json_locations &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">text=</span>arrangement, <span class="dt">colClasses=</span><span class="st">&quot;character&quot;</span>)

gci1.1_indicators_meta &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">apply</span>(json_locations,<span class="dv">1</span>,
                           <span class="cf">function</span>(x){<span class="kw">indicate_desc</span>(<span class="dt">x=</span>x[<span class="dv">1</span>], <span class="dt">y=</span> x[<span class="dv">2</span>],
                                                <span class="dt">inlist=</span>v1.1_json)}))
gci1.0_indicators_meta &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">apply</span>(json_locations,<span class="dv">1</span>,
                           <span class="cf">function</span>(x){<span class="kw">indicate_desc</span>(<span class="dt">x=</span>x[<span class="dv">1</span>], <span class="dt">y=</span> x[<span class="dv">2</span>],
                                                <span class="dt">inlist=</span>v1.0_json)}))

gci_indicator_info &lt;-<span class="st"> </span><span class="cf">function</span>(x,y, inlist){
    z &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ranks =</span> 
  <span class="kw">as.numeric</span>(v1.1_json[[<span class="st">&quot;countries&quot;</span>]][[<span class="st">&quot;indicators&quot;</span>]][[x]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;rank&quot;</span>]]),
                    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
    codes &lt;-<span class="st"> </span>v1.1_json[[<span class="st">&quot;countries&quot;</span>]][[<span class="st">&quot;indicators&quot;</span>]][[x]][[<span class="st">&quot;children&quot;</span>]][[y]][[<span class="st">&quot;code&quot;</span>]]
    codes &lt;-<span class="st"> </span>codes[<span class="kw">min</span>(<span class="kw">which</span>(<span class="op">!</span><span class="kw">is.na</span>(codes)))]
    <span class="kw">names</span>(z) &lt;-<span class="st"> </span>codes
    <span class="kw">return</span>(z)
}

gci1.1_indicators &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">apply</span>(json_locations,<span class="dv">1</span>,
                           <span class="cf">function</span>(x){<span class="kw">gci_indicator_info</span>(<span class="dt">x=</span>x[<span class="dv">1</span>], <span class="dt">y=</span> x[<span class="dv">2</span>],
                                                <span class="dt">inlist=</span>v1.1_json)}))

gci1.0_indicators &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="kw">apply</span>(json_locations,<span class="dv">1</span>,
                           <span class="cf">function</span>(x){<span class="kw">gci_indicator_info</span>(<span class="dt">x=</span>x[<span class="dv">1</span>], <span class="dt">y=</span> x[<span class="dv">2</span>],
                                                <span class="dt">inlist=</span>v1.0_json)}))

<span class="kw">rm</span>(v1.0_json, v1.1_json, json_locations)

<span class="co"># upon inspection Côte d&#39;Ivoire is present twice, the second time as a phantom entry, </span>
<span class="co"># so I am removing the second entry(number 42) which has no associated data</span>
gci1.<span class="dv">0</span> &lt;-<span class="st"> </span>gci1.<span class="dv">0</span>[<span class="op">-</span><span class="dv">42</span>,]
gci1.<span class="dv">1</span> &lt;-<span class="st"> </span>gci1.<span class="dv">1</span>[<span class="op">-</span><span class="dv">42</span>,]
gci1.0_indicators &lt;-<span class="st"> </span>gci1.0_indicators[<span class="op">-</span><span class="dv">42</span>,]
gci1.1_indicators &lt;-<span class="st"> </span>gci1.1_indicators[<span class="op">-</span><span class="dv">42</span>,]

## rather than calculate out the aggregate scores (given tiebreaking etc) I have just
## copied the aggregates from the website
goodc &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;raw_data/goodcountryindex.txt&quot;</span>)
gci1.1_aggregate &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Country.Name =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">6</span>],
                 <span class="dt">a_Overall =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">7</span>],
                 <span class="dt">b_ScienceTechnology =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">5</span>],
                 <span class="dt">c_Culture =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">4</span>],
                 <span class="dt">d_InternationalPeaceSecurity =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span>],
                 <span class="dt">e_WorldOrder =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span>],
                 <span class="dt">f_PlanetClimate =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>],
                 <span class="dt">g_ProsperityEquality =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span>],
                 <span class="dt">h_HealthWellbeing =</span> goodc[<span class="dv">1</span><span class="op">:</span><span class="dv">163</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>],
                 <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># combine the aggregate and the individual scores</span>
<span class="co"># this implicitely clears out entries without data for the 1.1 aggregate merge</span>
gci1.<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">cbind</span>(gci1.<span class="dv">0</span>, gci1.0_indicators)
gci1.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">cbind</span>(gci1.<span class="dv">1</span>, gci1.1_indicators)

gci1.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">merge</span>(gci1.1_aggregate, gci1.<span class="dv">1</span>, <span class="dt">by.x=</span><span class="st">&quot;Country.Name&quot;</span>, <span class="dt">by.y=</span><span class="st">&quot;name&quot;</span>)
<span class="co"># make aggregates numerics</span>
gci1.<span class="dv">1</span><span class="op">$</span>a_Overall &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                     <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>a_Overall))
gci1.<span class="dv">1</span><span class="op">$</span>b_ScienceTechnology &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                               <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>b_ScienceTechnology))
gci1.<span class="dv">1</span><span class="op">$</span>c_Culture &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                     <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>c_Culture))
gci1.<span class="dv">1</span><span class="op">$</span>d_InternationalPeaceSecurity &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,<span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>d_InternationalPeaceSecurity))
gci1.<span class="dv">1</span><span class="op">$</span>e_WorldOrder &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                        <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>e_WorldOrder))
gci1.<span class="dv">1</span><span class="op">$</span>f_PlanetClimate &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                           <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>f_PlanetClimate))
gci1.<span class="dv">1</span><span class="op">$</span>g_ProsperityEquality &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                                <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>g_ProsperityEquality))
gci1.<span class="dv">1</span><span class="op">$</span>h_HealthWellbeing &lt;-<span class="st">  </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;[ abcdefghijklmnopqrstuvwxyzz]+.*&quot;</span>,
                                             <span class="st">&quot;&quot;</span>,gci1.<span class="dv">1</span><span class="op">$</span>h_HealthWellbeing))

<span class="kw">rm</span>(gci1.0_indicators, gci1.1_aggregate, gci1.1_indicators)
<span class="co"># world bank GDP per capita in 2011</span>
GDPcap &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;raw_data/API_NY_GDP_PCAP/API_NY.GDP.PCAP.CD_DS2_en_csv_v2.csv&quot;</span>,
                   <span class="dt">skip=</span><span class="dv">4</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
GDPcap11 &lt;-<span class="st"> </span>GDPcap[,<span class="kw">c</span>(<span class="st">&quot;Country.Name&quot;</span>, <span class="st">&quot;Country.Code&quot;</span>, <span class="st">&quot;X2011&quot;</span>)]
<span class="kw">rm</span>(GDPcap)

<span class="co"># world bank GDP  in 2011</span>
GDP &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;raw_data/API_NY_GDP_MKTP/API_NY.GDP.MKTP.CD_DS2_en_csv_v2.csv&quot;</span>,
                   <span class="dt">skip=</span><span class="dv">4</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
GDP11 &lt;-<span class="st"> </span>GDP[,<span class="kw">c</span>(<span class="st">&quot;Country.Name&quot;</span>, <span class="st">&quot;Country.Code&quot;</span>, <span class="st">&quot;X2011&quot;</span>)]
<span class="kw">rm</span>(GDP)

<span class="co"># wikipedia page</span>
wp &lt;-<span class="st"> &quot;https://en.wikipedia.org/wiki/List_of_oldest_universities_in_continuous_operation&quot;</span>
html =<span class="st"> </span><span class="kw">read_html</span>(wp)
tbls &lt;-<span class="st"> </span><span class="kw">html_table</span>(<span class="kw">html_nodes</span>(html, <span class="st">&quot;table&quot;</span>), <span class="dt">fill=</span><span class="ot">TRUE</span>)
u1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">1</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">1</span>]][[<span class="dv">4</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">2</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">2</span>]][[<span class="dv">1</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">3</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">3</span>]][[<span class="dv">1</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">4</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">4</span>]][[<span class="dv">1</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u5 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">5</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">5</span>]][[<span class="dv">1</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u6 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">6</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">6</span>]][[<span class="dv">1</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u7 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">yr=</span>tbls[[<span class="dv">7</span>]][[<span class="st">&quot;Year&quot;</span>]], <span class="dt">whr=</span>tbls[[<span class="dv">7</span>]][[<span class="dv">1</span>]], <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u1<span class="op">$</span>whr &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;.*, &quot;</span>, <span class="st">&quot;&quot;</span>, u1<span class="op">$</span>whr)
u1<span class="op">$</span>yr[<span class="dv">10</span>] &lt;-<span class="st"> &quot;1293&quot;</span>
u1 &lt;-<span class="st"> </span>u1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(<span class="dt">col=</span>yr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;yr&quot;</span>,<span class="st">&quot;mr&quot;</span>), <span class="dt">sep=</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mr)
u2 &lt;-<span class="st"> </span>u2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(<span class="dt">col=</span>whr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;whr&quot;</span>,<span class="st">&quot;nr&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n\\</span><span class="st">(&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;right&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>yr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;yr&quot;</span>,<span class="st">&quot;mr&quot;</span>), <span class="dt">sep=</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mr, <span class="op">-</span>nr)
u3 &lt;-<span class="st"> </span>u3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(<span class="dt">col=</span>yr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;yr&quot;</span>,<span class="st">&quot;mr&quot;</span>), <span class="dt">sep=</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mr)
u4 &lt;-<span class="st"> </span>u4 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>whr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;whr&quot;</span>,<span class="st">&quot;nr&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n\\</span><span class="st">(&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;right&quot;</span>, <span class="dt">extra=</span><span class="st">&quot;merge&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>yr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;yr&quot;</span>,<span class="st">&quot;mr&quot;</span>), <span class="dt">sep=</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mr, <span class="op">-</span>nr)
u5a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">whr=</span><span class="kw">c</span>(<span class="st">&quot;Anguilla&quot;</span>,
                        <span class="st">&quot;Antigua and Barbuda&quot;</span>,
                        <span class="st">&quot;Bahamas&quot;</span>,
                        <span class="st">&quot;Barbados&quot;</span>,
                        <span class="st">&quot;Belize&quot;</span>,
                        <span class="st">&quot;British Virgin Islands&quot;</span>,
                        <span class="st">&quot;Cayman Islands&quot;</span>,
                        <span class="st">&quot;Dominica&quot;</span>,
                        <span class="st">&quot;Grenada&quot;</span>,
                        <span class="st">&quot;Jamaica&quot;</span>,
                        <span class="st">&quot;Montserrat&quot;</span>,
                        <span class="st">&quot;St. Kitts and Nevis&quot;</span>,
                        <span class="st">&quot;St. Lucia&quot;</span>,
                        <span class="st">&quot;St. Vincent and the Grenadines&quot;</span>,
                        <span class="st">&quot;Trinidad and Tobago&quot;</span>,
                        <span class="st">&quot;Turks and Caicos&quot;</span>), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u5a<span class="op">$</span>yr &lt;-<span class="st"> &quot;1948&quot;</span>
u5 &lt;-<span class="st"> </span>u5[<span class="op">-</span><span class="dv">25</span>,]
u6 &lt;-<span class="st"> </span>u6 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>whr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;whr&quot;</span>,<span class="st">&quot;nr&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n\\</span><span class="st">(&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;right&quot;</span>, <span class="dt">extra=</span><span class="st">&quot;merge&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>yr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;yr&quot;</span>,<span class="st">&quot;mr&quot;</span>), <span class="dt">sep=</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mr, <span class="op">-</span>nr)
u7a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">whr=</span><span class="kw">c</span>(<span class="st">&quot;Cook Islands&quot;</span>,
                           <span class="st">&quot;Fiji&quot;</span>,
                           <span class="st">&quot;Kiribati&quot;</span>,
                           <span class="st">&quot;Marshall Islands&quot;</span>,
                           <span class="st">&quot;Nauru&quot;</span>,
                           <span class="st">&quot;Niue&quot;</span>,
                           <span class="st">&quot;Samoa&quot;</span>,
                           <span class="st">&quot;Solomon Islands&quot;</span>,
                           <span class="st">&quot;Tokelau&quot;</span>,
                           <span class="st">&quot;Tonga&quot;</span>,
                           <span class="st">&quot;Tuvalu&quot;</span>,
                           <span class="st">&quot;Vanuatu&quot;</span>), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
u7a<span class="op">$</span>yr &lt;-<span class="st"> &quot;1968&quot;</span>
u7 &lt;-<span class="st"> </span>u7[<span class="op">-</span><span class="dv">11</span>,]
u7 &lt;-<span class="st"> </span>u7 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>whr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;whr&quot;</span>,<span class="st">&quot;nr&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n\\</span><span class="st">(&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;right&quot;</span>, <span class="dt">extra=</span><span class="st">&quot;merge&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(<span class="dt">col=</span>yr, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;yr&quot;</span>,<span class="st">&quot;mr&quot;</span>), <span class="dt">sep=</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>mr, <span class="op">-</span>nr)
unis &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(u1,u2,u3,u4,u5,u5a,u6,u7,u7a)
<span class="kw">rm</span>(u1,u2,u3,u4,u5,u5a,u6,u7,u7a,html,tbls)
unis &lt;-<span class="st"> </span>unis <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">yr =</span> <span class="kw">as.numeric</span>(yr)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(yr)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(whr) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">yr =</span> <span class="kw">min</span>(yr))

<span class="co"># wikipedia&#39;s country names not standard, so I am adding the ISO codes</span>
unis<span class="op">$</span>isocode &lt;-<span class="st"> </span><span class="kw">countrycode</span>(unis<span class="op">$</span>whr, <span class="dt">origin=</span><span class="st">&quot;country.name&quot;</span>, <span class="dt">destination=</span><span class="st">&quot;iso3c&quot;</span>)

<span class="co"># Doing business spreadsheet</span>
<span class="co"># the wp1 wp2 paste0 is just to fit code with margins</span>
wp1 &lt;-<span class="st"> &quot;http://www.doingbusiness.org/data/~/media/WBG/DoingBusiness/Documents/&quot;</span>
wp2 &lt;-<span class="st"> &quot;Miscellaneous/DB17-Distance-to-Frontier-historical-dataset.xlsx&quot;</span>
<span class="kw">download.file</span>(<span class="kw">paste0</span>(wp1, wp2), <span class="dt">destfile=</span><span class="st">&quot;raw_data/DTF.xlsx&quot;</span>)
dtf &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;raw_data/DTF.xlsx&quot;</span>, <span class="dt">sheet=</span><span class="st">&quot;DB05-17 for Excel&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">&quot;cod&quot;</span>, <span class="st">&quot;economy&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;incomegroup&quot;</span>, <span class="st">&quot;dbyear&quot;</span>,<span class="st">&quot;DTFtradedef_db1415&quot;</span>,
         <span class="st">&quot;tradingexportdocsdtf&quot;</span>, <span class="st">&quot;tradingexporttimedtf&quot;</span>, <span class="st">&quot;tradingimportdocsdtf&quot;</span>,
         <span class="st">&quot;tradingimporttimedtf&quot;</span>, <span class="st">&quot;tradingexportcost_defdtf&quot;</span>, <span class="st">&quot;tradingimportcost_defdtf&quot;</span>,
         <span class="st">&quot;tradeXcostborderdtf&quot;</span>, <span class="st">&quot;tradeMcostborderdtf&quot;</span>, <span class="st">&quot;tradeXtimeborderdtf&quot;</span>,
         <span class="st">&quot;tradeMtimeborderdtf&quot;</span>, <span class="st">&quot;tradeMcostdocsdtf&quot;</span>, <span class="st">&quot;tradeMtimedocsdtf&quot;</span>,
         <span class="st">&quot;tradeXcostdocsdtf&quot;</span>, <span class="st">&quot;tradeXtimedocsdtf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dbyear =</span> <span class="kw">as.numeric</span>(dbyear)) 

<span class="co">#GCI1.1 and GCI1.0 are both missing a few ISO codes</span>
gci1.<span class="dv">1</span><span class="op">$</span>isoCode[<span class="kw">is.na</span>(gci1.<span class="dv">1</span><span class="op">$</span>isoCode)] &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">countrycode</span>(gci1.<span class="dv">1</span><span class="op">$</span>Country.Name[<span class="kw">is.na</span>(gci1.<span class="dv">1</span><span class="op">$</span>isoCode)], <span class="dt">origin=</span><span class="st">&quot;country.name&quot;</span>,
              <span class="dt">destination=</span><span class="st">&quot;iso3c&quot;</span>)
gci1.<span class="dv">0</span><span class="op">$</span>isoCode[<span class="kw">is.na</span>(gci1.<span class="dv">0</span><span class="op">$</span>isoCode)] &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">countrycode</span>(gci1.<span class="dv">0</span><span class="op">$</span>name[<span class="kw">is.na</span>(gci1.<span class="dv">0</span><span class="op">$</span>isoCode)], <span class="dt">origin=</span><span class="st">&quot;country.name&quot;</span>,
              <span class="dt">destination=</span><span class="st">&quot;iso3c&quot;</span>)

## now save everything in feather format for the other chapters
<span class="kw">write_feather</span>(dtf, <span class="st">&quot;processed_data/dtf.feather&quot;</span>)
<span class="kw">write_feather</span>(gci1.<span class="dv">0</span>, <span class="st">&quot;processed_data/gci10.feather&quot;</span>)
<span class="kw">write_feather</span>(gci1.0_indicators_meta, <span class="st">&quot;processed_data/gci10meta.feather&quot;</span>)
<span class="kw">write_feather</span>(gci1.<span class="dv">1</span>, <span class="st">&quot;processed_data/gci11.feather&quot;</span>)
<span class="kw">write_feather</span>(gci1.1_indicators_meta, <span class="st">&quot;processed_data/gci11meta.feather&quot;</span>)
<span class="kw">write_feather</span>(GDP11, <span class="st">&quot;processed_data/gdp11.feather&quot;</span>)
<span class="kw">write_feather</span>(GDPcap11, <span class="st">&quot;processed_data/gdpcap11.feather&quot;</span>)
<span class="kw">write_feather</span>(unis, <span class="st">&quot;processed_data/unis.feather&quot;</span>)</code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>

<a href="overall-total-score.html" class="navigation navigation-next navigation-unique" aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "chapter"
}
});
});
</script>

</body>

</html>
